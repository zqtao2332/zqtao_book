# MySQL总结之一条SQL语句的执行流程

首先看一下MySQL的宏观执行图

![SQL执行过程图](https://upload-images.jianshu.io/upload_images/18375227-8e1f04724ca6881f.png?imageMogr2/auto-orient/strip|imageView2/2/w/1096/format/webp)

 一条SQL语句过来的流程是什么样的？ 

总结下来，共分为6个部分：其中涉及到缓存、解析器、预处理器、查询优化器、查询执行器等组件。

**一条SQL进入**

-》登录认证

-》查询缓存

-》解析器构造解析树，预处理器进一步构造解析树

-》 查询优化器将解析树转化为查询计划

-》查询执行引擎执行查询计划

-》返回数据，更新查询缓存

**1、登录验证**：当客户端连接到MySQL服务器时，服务器会对其进行认证。两种认证方式：a、通过用户名和密码认证 ；b、通过SSL证书进行认证；登录认证后，服务器还会验证客户端是否具有执行某个查询的操作权限。

**2、查询缓存：**在进行正式查询之前，MySQL服务器会检查查询缓存，如果能找到对应的查询，那么将不再执行查询解析，解析树优化，查询计划执行等操作，直接返回缓存中的结果集。

**3、解析器构造解析树，预处理器进一步构造解析树**：MySQL的解析器会根据查询语句，构造一棵解析树，主要是根据语法规则来校验语句是否正确，比如MySQL的关键字是否正确，关键字的顺序是否正确？至于预处理器主要是对查询语句进行进一步的校验，比如表名，字段名是否正确等。

**4、查询优化器将解析树转化为查询计划**：一般情况下，一条查询会有很多的执行方式，最终返回相同的查询结果，优化器的作用就是**根据查询成本找到最优的执行计划**。

**5、查询执行引擎执行查询计划**：执行计划调用查询执行引擎，而查询引擎通过一系列API接口查询到数据 

**6、返回数据，更新查询缓存**：得到数据之后，在返回给客户端的同时，会将数据存在查询缓存中 

参考： https://www.jianshu.com/p/2530d1185778 

