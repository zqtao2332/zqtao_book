# MySQL总结之索引

## 1.索引分类：聚簇索引和非聚簇索引

转载： https://www.jianshu.com/p/fa8192853184 

### 通俗讲

**聚簇索引**：将数据存储与索引放在一起， 索引结构的叶子节点保存了**行数据** ,找到了索引就是找到了数据。

**非聚簇索引**：将数据存储与索引分开存储，索引结构中的叶子结点指向了数据的对应行。

1. myisam通过key_buffer把索引先缓存到内存中，当需要访问数据时（通过索引访问数据），在内存中直接搜索索引，然后通过索引找到**磁盘相应数据**，这也就是为什么索引不在key buffer命中时，速度慢的原因
2. 澄清一个概念：innodb中，在聚簇索引之上创建的索引称之为辅助索引，辅助索引访问数据总是需要二次查找，非聚簇索引都是辅助索引，像复合索引、前缀索引、唯一索引， **辅助索引叶子节点存储的不再是行的物理位置，而是主键值，辅助索引访问数据总是需要二次查找**。 

## 聚簇索引与非聚簇索引的使用场景

![聚簇索引与非聚簇索引的使用场景](https://upload-images.jianshu.io/upload_images/10154499-d53a5ce9cecf22f3.png?imageMogr2/auto-orient/strip|imageView2/2/w/864/format/webp)

## 聚簇索引具有唯一性

聚簇索引将数据存储和索引放在一起，因此一张表仅能有一个聚簇索引。

**那么为什么仅能有一个聚簇索引呢？**

表中行的物理顺序和索引中行的物理顺序是相同的，**在创建任何非聚簇索引之前创建非聚簇索引**，因为表中行的数据物理存储是按照聚簇索引来进行顺序排列的，并且自动维护这个顺序。

## 误区：把主键自动设置为聚簇索引

包含问题：主键是聚簇索引？更改其他字段为聚簇索引怎么办?

**聚簇索引默认是主键**。如果表中没有定义主键，InnoDB会选择一个**唯一且非空索引**替代。如果没有这样的索引，InnoDB会**隐式的定义一个主键**来作为聚簇索引。InnoDB值聚集在同一个页面中的记录，对行记录进行**索引排序**，实现索引结构。**如果你已经设置了主键作为聚簇索引，想要添加新的聚簇索引，必须先删除主键，然后添加我们想要的聚簇索引，最后恢复设置主键即可。**

此时其他索引只能被定义为非聚簇索引。这个是最大的误区。有的主键还是无意义的自动增量字段，那样的话Clustered index对效率的帮助，完全被浪费了。

刚才说到了，聚簇索引性能最好而且具有唯一性，所以非常珍贵，必须慎重设置。**一般要根据这个表最常用的SQL查询方式来进行选择，某个字段作为聚簇索引，或组合聚簇索引**，这个要看实际情况。

 记住我们的**最终目的**就是**在相同结果集情况下，尽可能减少逻辑IO**。 

## 结合图再仔细点看

![](https://upload-images.jianshu.io/upload_images/10154499-5244179cc19a1c21.PNG?imageMogr2/auto-orient/strip|imageView2/2/w/164/format/webp)



![InnoDB和MyISAM对索引的检索过程](https://upload-images.jianshu.io/upload_images/10154499-5772dddedb909374.PNG?imageMogr2/auto-orient/strip|imageView2/2/w/633/format/webp)

